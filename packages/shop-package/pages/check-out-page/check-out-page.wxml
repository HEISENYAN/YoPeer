<view class = "main-page">
  <t-navbar
    t-class-placeholder="t-navbar-placeholder"
    t-class-content="t-navbar-content"
    title="结算"
    left-arrow
    bind:go-back="handleBack"
    borderless = "true"
  />
  <view class="scroll-area" type="list">
    <view class="intro">欢迎来到YoPeer港校新生团购活动🐱</view>
    <van-cell-group inset class="unit-area">
      <van-cell title="港校新生团购结算"/>
      <block wx:for = "{{checkOutInfo}}" wx:key = "checkOutKey" wx:for-item = "checkOutItem">
        <block wx:if = "{{checkOutItem.selectedNum!=0}}">
          <van-cell title="{{checkOutItem.prodName}}" value="¥{{checkOutItem.price * checkOutItem.selectedNum / 100}}" label="件数：{{checkOutItem.selectedNum}} {{checkOutItem.specificOptions}}" />
        </block>
      </block>
      <van-cell title="总金额：" value="¥{{checkOutPrice/100}}" size="large" value-class="checkOutPrice"/>
    </van-cell-group>

    <van-cell-group inset class="unit-area2">
      <!-- <van-cell title="优惠券" is-link value="" />
      <van-cell title="备注" is-link value="" arrow-direction="down"/>
      <van-cell title="地址" is-link value="" bind:tap="onEditAddress"/> -->
      <van-cell title="优惠码" is-link  />
      <van-cell title="备注" is-link  />
      <van-cell title="地址" is-link  label = "{{addressText}}" bind:tap="onEditAddress" />
      <van-cell title="预计收货时间" is-link value="{{dateText || ''}}" data-mode="date" bindtap="showDatePicker"  class="test" t-class="panel-item"/>
      <!-- 年月日 picker-->
      <t-date-time-picker
        title="选择收获时间"
        visible="{{dateVisible}}"
        mode="date"
        defaultValue="{{date}}"
        format="YYYY-MM-DD"
        bindchange="onDateConfirm"
        bindpick="onColumnChange"
        bindcancel="hideDatePicker"
        start="{{start}}"
        end="{{end}}"
      />
    </van-cell-group>

    <view style = "height: {{offsetMargin}}px; width:100%;background-color: rgb(241,241,241);" ></view>
    <!-- 结算前弹出框 -->
      <t-popup visible="{{visible}}" bind:visible-change="onVisibleChange" placement="center">
        <view class="popup-container">
          <view class="header">
            <view class="title">请确认以下信息准确无误：</view>
            <!-- 可选：添加一个关闭按钮 -->
            <t-icon t-class="close-btn" name="close-circle" size="32" color="#fff" bind:tap="onClose" />
          </view>
          <text class="content">{{CheckoutPopupContent}}</text>
          <t-button class="checkout-button" bind:tap="onCheckout" theme="primary">确认无误 立即付款!</t-button>
        </view>
      </t-popup>
      <van-submit-bar
        price="{{ checkOutPrice * 1}}"
        button-text="结算"
        bind:submit="checkoutPopup"
        tip="{{ true }}"
        id = "subBar"
      >
      </van-submit-bar>
    </view>

</view>   

